<html>
  <head>
    <meta charset="UTF-8" />
    <title>Sigma Neo4j example</title>
    <script src="https://use.fontawesome.com/bd149a0111.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/neo4j-driver"></script>
    <script
      src="https://code.jquery.com/jquery-3.6.1.min.js"
      integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ="
      crossorigin="anonymous"
    ></script>
    <!-- <script src="https://cdn.jsdelivr.net/npm/neosig@1.2.2/docs/neosig-1.2.2.js"></script> -->
    <script type="text/javascript" src="neosig-1.3.0.js"></script>
    <style>
      body {
        margin: 0;
        display: flex;
      }
      body > div {
        padding: 10px;
        height: 800px;
      }
      #graph-container {
        width: 80%;
      }
      #right-taskpane {
        width: 20%;
      }
      #properties {
        height: 35%;
        border: solid 1px black;
      }
      #history {
        height: 65%;
        border: solid 1px black;
      }
    </style>
  </head>
  <body>
    <div id="graph-container"></div>
    <div id="right-taskpane">
      <div id="properties"></div>
      <div id="history"></div>
    </div>
    <script>
      var neo4jConfig = {
        url: "bolt://3.86.190.105:7687",
        user: "neo4j",
        password: "sprayers-drip-stowage",
      };

      var style = {
        labels: {
          Person: {
            label: "name",
            color: "#654321",
            size: 8,
            icon: {
              name: "f007",
              color: "#FFF",
              scale: 1.0,
            },
          },
          Movie: {
            label: "title",
            color: "#123456",
            size: 8,
            icon: {
              name: "f008",
              color: "#FFF",
              scale: 1.0,
            },
          },
        },
        edges: {
          ACTED_IN: {
            color: "#040404",
            size: 1,
            label: "roles",
          },
          DIRECTED: {
            color: "#040404",
            size: 2,
          },
          PRODUCED: {
            color: "#040404",
            size: 5,
          },
        },
      };

      Neo4jGraph(
        neo4jConfig,
        style,
        "MATCH (n:Movie)-[r]-(m:Person) RETURN n,r,m LIMIT 20"
      ).then(function (result) {
        var sig = new sigma({
          graph: result,
          renderer: {
            container: "graph-container",
            type: "canvas",
          },
          settings: {
            edgeLabelThreshold: 1,
            drawEdgeLabels: true,
            edgeLabelSize: "fixed",
            defaultEdgeLabelSize: 8,
            enableEdgeHovering: true,
            edgeHoverExtremities: true,
            autoRescale: true,
            minEdgeSize: 1,
            maxEdgeSize: 5,
            minNodeSize: 1,
            maxNodeSize: 20,
          },
        });

        sig.bind("clickNode", function (e) {
          var property = e.data.node.properties;
          console.log(property);
          // create the tlis tof prop. from returend Object
          $("#properties").empty();
          for (var key in property) {
            console.log(key);
            $("#properties").append(
              " <li>" + key + " : " + property[key] + "</li>"
            );
          }
        });

        // start layout
        sig.startForceAtlas2();
        setTimeout(() => {
          sig.stopForceAtlas2();
        }, Math.log(result.nodes.length * result.edges.length) * 1000);
      });
    </script>
  </body>
</html>
